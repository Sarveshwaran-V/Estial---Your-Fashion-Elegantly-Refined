<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outfit Analyzer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f9fafb;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2rem;
        }

        .tagline {
            color: #666;
            font-style: italic;
        }

        .feature-toggle {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            gap: 10px;
        }

        .feature-btn {
            padding: 10px 20px;
            background-color: #e0e7ff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            color: #4f46e5;
            transition: background-color 0.3s;
        }

        .feature-btn.active {
            background-color: #4f46e5;
            color: white;
        }

        .feature-content {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #444;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            background-color: #f9fafb;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        button {
            background-color: #4f46e5;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            width: 100%;
            margin-top: 20px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #4338ca;
        }

        .image-preview {
            width: 100%;
            margin-top: 20px;
            border: 2px dashed #ddd;
            border-radius: 5px;
            padding: 10px;
            text-align: center;
        }

        #preview-image, #preview-image-recommend {
            max-width: 100%;
            max-height: 300px;
            display: none;
        }

        .result-section {
            margin-top: 20px;
            display: none;
        }

        .analysis-item {
            margin-bottom: 20px;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #4f46e5;
        }

        .analysis-item h3 {
            margin-bottom: 15px;
            color: #4f46e5;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            padding-bottom: 8px;
            border-bottom: 1px solid #e5e7eb;
        }

        .analysis-item h3 .icon {
            margin-right: 10px;
            font-size: 1.5rem;
        }

        .analysis-score {
            display: inline-block;
            background-color: #4f46e5;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: bold;
            margin-left: 10px;
        }

        .analysis-content {
            padding: 10px 5px;
        }

        .analysis-section-title {
            font-weight: 600;
            color: #4f46e5;
            margin: 15px 0 8px 0;
            font-size: 1.1rem;
        }

        .analysis-subsection {
            margin-bottom: 12px;
            padding-left: 10px;
            border-left: 2px solid #e0e7ff;
        }

        .analysis-subsection-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .improvement-suggestion {
            background-color: #f0fdf4;
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 3px solid #10b981;
        }

        .improvement-title {
            font-weight: 600;
            color: #065f46;
            margin-bottom: 5px;
        }

        .outfit-example {
            background-color: #eff6ff;
            padding: 12px;
            border-radius: 6px;
            margin: 15px 0 5px 0;
            border-left: 3px solid #3b82f6;
        }

        .outfit-title {
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 5px;
        }

        .loader {
            border: 5px solid #f3f3f3;
            border-radius: 50%;
            border-top: 5px solid #4f46e5;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            color: #dc2626;
            margin-top: 10px;
            padding: 10px;
            background-color: #fee2e2;
            border-radius: 5px;
            display: none;
        }

        .profile-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .profile-actions button {
            width: auto;
            padding: 10px 15px;
            font-size: 0.9rem;
        }

        .success-message {
            color: #16a34a;
            margin-top: 10px;
            padding: 10px;
            background-color: #dcfce7;
            border-radius: 5px;
            display: none;
        }

        /* Wardrobe Styles */
        .wardrobe-container {
            display: none;
            margin-top: 20px;
            background-color: #fff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .wardrobe-toggle {
            background-color: #4f46e5;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .wardrobe-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .wardrobe-item {
            background-color: #f9fafb;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid #e5e7eb;
            position: relative;
        }

        .wardrobe-item h4 {
            margin-bottom: 5px;
            color: #4f46e5;
        }

        .wardrobe-item p {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .wardrobe-item img {
            max-width: 100%;
            max-height: 100px;
            display: block;
            margin: 10px auto;
            border-radius: 5px;
        }

        .wardrobe-item .delete-item {
            position: absolute;
            top: 5px;
            right: 5px;
            background: none;
            border: none;
            color: #dc2626;
            cursor: pointer;
            font-size: 1rem;
        }

        .add-item-form {
            margin-top: 20px;
            background-color: #f9fafb;
            padding: 15px;
            border-radius: 8px;
        }

        .use-wardrobe-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
            cursor: pointer;
            user-select: none;
        }

        .use-wardrobe-toggle input {
            width: auto;
            margin: 0;
        }

        .use-wardrobe-toggle label {
            margin: 0;
            cursor: pointer;
        }

        .wardrobe-selection {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background-color: #f9fafb;
            border-radius: 8px;
        }

        .wardrobe-selection.active {
            display: block;
        }

        .wardrobe-selection-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .wardrobe-selection-item {
            background-color: #e0e7ff;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-container input {
            width: auto;
            margin: 0;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Outfit Analyzer</h1>
            <p class="tagline">Find out what works best for your body type!</p>
        </header>

        <!-- Profile Actions -->
        <div class="profile-actions">
            <button onclick="saveProfile()"><i class="fas fa-save"></i> Save Profile</button>
            <button onclick="clearProfile()"><i class="fas fa-trash"></i> Clear Profile</button>
            <button onclick="toggleWardrobe()" id="wardrobe-toggle-btn"><i class="fas fa-wardrobe"></i> My Wardrobe</button>
        </div>

        <!-- Wardrobe Section -->
        <div class="wardrobe-container" id="wardrobe-container">
            <h3><i class="fas fa-wardrobe"></i> My Wardrobe</h3>
            <p>Add items to your wardrobe to use them in outfit analysis and recommendations.</p>
            
            <div class="wardrobe-items" id="wardrobe-items">
                <!-- Wardrobe items will be added here dynamically -->
            </div>
            
            <div class="add-item-form">
                <h4><i class="fas fa-plus"></i> Add New Item</h4>
                <div class="form-group">
                    <label for="item-name">Item Name:</label>
                    <input type="text" id="item-name" placeholder="e.g., Blue Jeans, White T-Shirt">
                </div>
                <div class="form-group">
                    <label for="item-type">Item Type:</label>
                    <select id="item-type">
                        <option value="top">Top</option>
                        <option value="bottom">Bottom</option>
                        <option value="dress">Dress</option>
                        <option value="outerwear">Outerwear</option>
                        <option value="shoes">Shoes</option>
                        <option value="accessory">Accessory</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="item-color">Color:</label>
                    <input type="text" id="item-color" placeholder="e.g., Navy Blue, Black">
                </div>
                <div class="form-group">
                    <label for="item-image">Upload Image (Optional):</label>
                    <input type="file" id="item-image" accept="image/*">
                </div>
                <button onclick="addWardrobeItem()"><i class="fas fa-plus"></i> Add to Wardrobe</button>
            </div>
        </div>

        <div class="feature-toggle">
            <button class="feature-btn active" onclick="showFeature('analyze')"><i class="fas fa-search"></i> Analyze Outfit</button>
            <button class="feature-btn" onclick="showFeature('recommend')"><i class="fas fa-tshirt"></i> What to Wear</button>
        </div>

        <!-- Analyze Outfit Feature -->
        <div id="analyze-feature" class="feature-content">
            <form id="analyzer-form">
                <div class="use-wardrobe-toggle">
                    <input type="checkbox" id="use-wardrobe-analyze" onchange="toggleWardrobeSelection('analyze')">
                    <label for="use-wardrobe-analyze">Use items from my wardrobe</label>
                </div>
                
                <div class="wardrobe-selection" id="wardrobe-selection-analyze">
                    <p>Select items from your wardrobe to analyze:</p>
                    <div class="wardrobe-selection-items" id="wardrobe-selection-items-analyze">
                        <!-- Wardrobe selection items will be added here dynamically -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="bodyType"><i class="fas fa-user"></i> Body Type:</label>
                    <select id="bodyType" required>
                        <option value="">Select body type</option>
                        <option value="rectangle">Rectangle</option>
                        <option value="hourglass">Hourglass</option>
                        <option value="pear">Pear</option>
                        <option value="apple">Apple</option>
                        <option value="inverted-triangle">Inverted Triangle</option>
                        <option value="athletic">Athletic</option>
                        <option value="petite">Petite</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="height"><i class="fas fa-ruler-vertical"></i> Height (cm):</label>
                    <input type="number" id="height" min="100" max="250" required>
                </div>

                <div class="form-group">
                    <label for="weight"><i class="fas fa-weight"></i> Weight (kg):</label>
                    <input type="number" id="weight" min="30" max="250" required>
                </div>

                <div class="form-group">
                    <label for="skinTone"><i class="fas fa-palette"></i> Skin Tone:</label>
                    <select id="skinTone" required>
                        <option value="">Select skin tone</option>
                        <option value="very-fair">Very Fair</option>
                        <option value="fair">Fair</option>
                        <option value="medium">Medium</option>
                        <option value="olive">Olive</option>
                        <option value="tan">Tan</option>
                        <option value="brown">Brown</option>
                        <option value="dark-brown">Dark Brown</option>
                        <option value="very-dark">Very Dark</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="hairColor"><i class="fas fa-cut"></i> Hair Color:</label>
                    <select id="hairColor" required>
                        <option value="">Select hair color</option>
                        <option value="black">Black</option>
                        <option value="dark-brown">Dark Brown</option>
                        <option value="brown">Brown</option>
                        <option value="light-brown">Light Brown</option>
                        <option value="blonde">Blonde</option>
                        <option value="red">Red</option>
                        <option value="auburn">Auburn</option>
                        <option value="gray">Gray/Silver</option>
                        <option value="white">White</option>
                        <option value="colored">Colored/Dyed</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="eyeColor"><i class="fas fa-eye"></i> Eye Color:</label>
                    <select id="eyeColor" required>
                        <option value="">Select eye color</option>
                        <option value="brown">Brown</option>
                        <option value="hazel">Hazel</option>
                        <option value="blue">Blue</option>
                        <option value="green">Green</option>
                        <option value="gray">Gray</option>
                        <option value="amber">Amber</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="gender"><i class="fas fa-venus-mars"></i> Gender:</label>
                    <select id="gender" required>
                        <option value="">Select gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="non-binary">Non-binary</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="outfitImage"><i class="fas fa-camera"></i> Upload Outfit Image:</label>
                    <input type="file" id="outfitImage" accept="image/*" onchange="previewImage(this, 'preview-image', 'preview-text')">
                    <div class="image-preview">
                        <img id="preview-image" src="#" alt="Preview">
                        <p id="preview-text">No image selected</p>
                    </div>
                </div>

                <button type="submit" id="analyze-button"><i class="fas fa-magic"></i> Analyze Outfit</button>
            </form>
            <div class="error-message" id="error-message"></div>
            <div class="success-message" id="success-message"></div>

            <div class="result-section" id="result-section">
                <div class="loader" id="loader"></div>
                <div class="analysis-section" id="analysis-section">
                    <div class="analysis-item">
                        <h3><span class="icon"><i class="fas fa-star"></i></span> Overall Suitability <span id="suitability-rating" class="analysis-score">0/10</span></h3>
                        <div class="analysis-content" id="suitability-result">
                            <p>Your outfit will be analyzed based on your body type and features.</p>
                        </div>
                    </div>

                    <div class="analysis-item">
                        <h3><span class="icon"><i class="fas fa-palette"></i></span> Color Harmony</h3>
                        <div class="analysis-content" id="color-harmony">
                            <p>We'll evaluate how well the colors complement your skin tone, hair, and eyes.</p>
                        </div>
                    </div>

                    <div class="analysis-item">
                        <h3><span class="icon"><i class="fas fa-ruler-combined"></i></span> Style Fit</h3>
                        <div class="analysis-content" id="style-fit">
                            <p>We'll assess how well the style works with your body type.</p>
                        </div>
                    </div>

                    <div class="analysis-item">
                        <h3><span class="icon"><i class="fas fa-lightbulb"></i></span> Suggestions</h3>
                        <div class="analysis-content" id="suggestions">
                            <p>You'll receive personalized suggestions for improvement.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- What to Wear Feature -->
        <div id="recommend-feature" class="feature-content" style="display: none;">
            <form id="recommend-form">
                <div class="use-wardrobe-toggle">
                    <input type="checkbox" id="use-wardrobe-recommend" onchange="toggleWardrobeSelection('recommend')">
                    <label for="use-wardrobe-recommend">Use items from my wardrobe</label>
                </div>
                
                <div class="wardrobe-selection" id="wardrobe-selection-recommend">
                    <p>Select items from your wardrobe to include in recommendations:</p>
                    <div class="wardrobe-selection-items" id="wardrobe-selection-items-recommend">
                        <!-- Wardrobe selection items will be added here dynamically -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="garmentDescription"><i class="fas fa-comment-alt"></i> Describe the Garment You Want to Wear:</label>
                    <textarea id="garmentDescription" placeholder="E.g., black jeans, white t-shirt, blue cardigan, etc." required></textarea>
                </div>

                <div class="form-group">
                    <label for="garmentImage"><i class="fas fa-camera"></i> Upload Garment Image (Optional):</label>
                    <input type="file" id="garmentImage" accept="image/*" onchange="previewImage(this, 'preview-image-recommend', 'preview-text-recommend')">
                    <div class="image-preview">
                        <img id="preview-image-recommend" src="#" alt="Preview">
                        <p id="preview-text-recommend">No image selected</p>
                    </div>
                </div>

                <button type="submit" id="recommend-button"><i class="fas fa-magic"></i> Get Outfit Recommendations</button>
            </form>
            <div class="error-message" id="error-message-recommend"></div>
            <div class="success-message" id="success-message-recommend"></div>

            <div class="result-section" id="recommend-result-section">
                <div class="loader" id="loader-recommend"></div>
                <div class="analysis-section" id="recommend-analysis-section">
                    <div class="analysis-item">
                        <h3><span class="icon"><i class="fas fa-star"></i></span> Base Garment Suitability</h3>
                        <div class="analysis-content" id="garment-suitability">
                            <p>We'll evaluate how well this garment works for your body type.</p>
                        </div>
                    </div>

                    <div class="analysis-item">
                        <h3><span class="icon"><i class="fas fa-list-ul"></i></span> Recommended Items</h3>
                        <div class="analysis-content" id="recommended-items">
                            <p>You'll see suggestions for items that pair well with your garment.</p>
                        </div>
                    </div>

                    <div class="analysis-item">
                        <h3><span class="icon"><i class="fas fa-tshirt"></i></span> Style Suggestions</h3>
                        <div class="analysis-content" id="style-suggestions">
                            <p>Get personalized style advice for your body type.</p>
                        </div>
                    </div>

                    <div class="analysis-item">
                        <h3><span class="icon"><i class="fas fa-lightbulb"></i></span> Complete Outfit Ideas</h3>
                        <div class="analysis-content" id="outfit-ideas">
                            <p>We'll provide complete outfit combinations for inspiration.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<script>
    // Gemini API Key - Replace with your actual API key
    const API_KEY = 'AIzaSyCZe2UKUmNcOZwm8HXaQ_51iagGFEKQUVk';

    // Wardrobe items array
    let wardrobeItems = [];

    // Load wardrobe from localStorage
    function loadWardrobe() {
        const savedWardrobe = localStorage.getItem('outfitAnalyzerWardrobe');
        if (savedWardrobe) {
            wardrobeItems = JSON.parse(savedWardrobe);
            renderWardrobeItems();
        }
    }

    // Save wardrobe to localStorage
    function saveWardrobe() {
        localStorage.setItem('outfitAnalyzerWardrobe', JSON.stringify(wardrobeItems));
    }

    // Toggle wardrobe visibility
    function toggleWardrobe() {
        const wardrobeContainer = document.getElementById('wardrobe-container');
        const toggleBtn = document.getElementById('wardrobe-toggle-btn');
        
        if (wardrobeContainer.style.display === 'block') {
            wardrobeContainer.style.display = 'none';
            toggleBtn.innerHTML = '<i class="fas fa-wardrobe"></i> My Wardrobe';
        } else {
            wardrobeContainer.style.display = 'block';
            toggleBtn.innerHTML = '<i class="fas fa-chevron-up"></i> Close Wardrobe';
            loadWardrobe();
        }
    }

    // Render wardrobe items
    function renderWardrobeItems() {
        const wardrobeItemsContainer = document.getElementById('wardrobe-items');
        wardrobeItemsContainer.innerHTML = '';
        
        if (wardrobeItems.length === 0) {
            wardrobeItemsContainer.innerHTML = '<p>Your wardrobe is empty. Add some items to get started!</p>';
            return;
        }
        
        wardrobeItems.forEach((item, index) => {
            const itemElement = document.createElement('div');
            itemElement.className = 'wardrobe-item';
            itemElement.innerHTML = `
                <button class="delete-item" onclick="deleteWardrobeItem(${index})"><i class="fas fa-times"></i></button>
                <h4>${item.name}</h4>
                <p><strong>Type:</strong> ${capitalizeFirstLetter(item.type)}</p>
                <p><strong>Color:</strong> ${item.color}</p>
                ${item.image ? `<img src="${item.image}" alt="${item.name}">` : ''}
            `;
            wardrobeItemsContainer.appendChild(itemElement);
        });
    }

    // Capitalize first letter
    function capitalizeFirstLetter(string) {
        return string.charAt(0).toUpperCase() + string.slice(1);
    }

    // Add new wardrobe item
    function addWardrobeItem() {
        const name = document.getElementById('item-name').value.trim();
        const type = document.getElementById('item-type').value;
        const color = document.getElementById('item-color').value.trim();
        const imageFile = document.getElementById('item-image').files[0];
        
        if (!name) {
            showErrorMessage('Please enter an item name', 'error-message');
            return;
        }
        
        const newItem = {
            id: Date.now(),
            name,
            type,
            color,
            image: null
        };
        
        if (imageFile) {
            const reader = new FileReader();
            reader.onload = function(e) {
                newItem.image = e.target.result;
                wardrobeItems.push(newItem);
                saveWardrobe();
                renderWardrobeItems();
                resetWardrobeForm();
                showSuccessMessage('Item added to wardrobe!', 'success-message');
                updateWardrobeSelections();
            };
            reader.readAsDataURL(imageFile);
        } else {
            wardrobeItems.push(newItem);
            saveWardrobe();
            renderWardrobeItems();
            resetWardrobeForm();
            showSuccessMessage('Item added to wardrobe!', 'success-message');
            updateWardrobeSelections();
        }
    }

    // Reset wardrobe form
    function resetWardrobeForm() {
        document.getElementById('item-name').value = '';
        document.getElementById('item-color').value = '';
        document.getElementById('item-image').value = '';
    }

    // Delete wardrobe item
    function deleteWardrobeItem(index) {
        if (confirm('Are you sure you want to remove this item from your wardrobe?')) {
            wardrobeItems.splice(index, 1);
            saveWardrobe();
            renderWardrobeItems();
            updateWardrobeSelections();
            showSuccessMessage('Item removed from wardrobe', 'success-message');
        }
    }

    // Toggle wardrobe selection in forms
    function toggleWardrobeSelection(feature) {
        const checkbox = document.getElementById(`use-wardrobe-${feature}`);
        const selectionDiv = document.getElementById(`wardrobe-selection-${feature}`);
        
        if (checkbox.checked) {
            selectionDiv.classList.add('active');
            updateWardrobeSelections();
        } else {
            selectionDiv.classList.remove('active');
        }
    }

    // Update wardrobe selection items
    function updateWardrobeSelections() {
        const analyzeSelection = document.getElementById('wardrobe-selection-items-analyze');
        const recommendSelection = document.getElementById('wardrobe-selection-items-recommend');
        
        analyzeSelection.innerHTML = '';
        recommendSelection.innerHTML = '';
        
        wardrobeItems.forEach(item => {
            const itemElement = document.createElement('div');
            itemElement.className = 'wardrobe-selection-item';
            itemElement.innerHTML = `
                <div class="checkbox-container">
                    <input type="checkbox" id="analyze-${item.id}" name="wardrobe-items" value="${item.id}">
                    <label for="analyze-${item.id}">${item.name}</label>
                </div>
            `;
            analyzeSelection.appendChild(itemElement.cloneNode(true));
            
            const recommendElement = itemElement.cloneNode(true);
            recommendElement.querySelector('input').id = `recommend-${item.id}`;
            recommendElement.querySelector('label').htmlFor = `recommend-${item.id}`;
            recommendSelection.appendChild(recommendElement);
        });
    }

    // Get selected wardrobe items
    function getSelectedWardrobeItems(feature) {
        const checkboxes = document.querySelectorAll(`#wardrobe-selection-items-${feature} input[type="checkbox"]:checked`);
        return Array.from(checkboxes).map(checkbox => {
            const itemId = parseInt(checkbox.value);
            return wardrobeItems.find(item => item.id === itemId);
        });
    }

    // Format wardrobe items for API prompt
    function formatWardrobeForPrompt(items) {
        if (!items || items.length === 0) return '';
        
        let promptText = "\n\nHere are the items from my wardrobe that I'm considering:\n";
        items.forEach(item => {
            promptText += `- ${item.name} (${item.type}, ${item.color})\n`;
        });
        return promptText;
    }

    // Show success message
    function showSuccessMessage(message, elementId) {
        const element = document.getElementById(elementId);
        element.textContent = message;
        element.style.display = 'block';
        setTimeout(() => {
            element.style.display = 'none';
        }, 3000);
    }

    // Show error message
    function showErrorMessage(message, elementId) {
        const element = document.getElementById(elementId);
        element.textContent = message;
        element.style.display = 'block';
    }

    // Hide error message
    function hideErrorMessage(elementId) {
        document.getElementById(elementId).style.display = 'none';
    }

    // Save profile to localStorage
    function saveProfile() {
        const profile = {
            bodyType: document.getElementById('bodyType').value,
            height: document.getElementById('height').value,
            weight: document.getElementById('weight').value,
            skinTone: document.getElementById('skinTone').value,
            hairColor: document.getElementById('hairColor').value,
            eyeColor: document.getElementById('eyeColor').value,
            gender: document.getElementById('gender').value,
        };
        localStorage.setItem('outfitAnalyzerProfile', JSON.stringify(profile));
        showSuccessMessage('Profile saved successfully!', 'success-message');
    }

    // Load profile from localStorage
    function loadProfile() {
        const profile = JSON.parse(localStorage.getItem('outfitAnalyzerProfile'));
        if (profile) {
            document.getElementById('bodyType').value = profile.bodyType;
            document.getElementById('height').value = profile.height;
            document.getElementById('weight').value = profile.weight;
            document.getElementById('skinTone').value = profile.skinTone;
            document.getElementById('hairColor').value = profile.hairColor;
            document.getElementById('eyeColor').value = profile.eyeColor;
            document.getElementById('gender').value = profile.gender;
        }
        
        // Load wardrobe as well
        loadWardrobe();
    }

    // Clear profile from localStorage
    function clearProfile() {
        localStorage.removeItem('outfitAnalyzerProfile');
        showSuccessMessage('Profile cleared!', 'success-message');
        location.reload();
    }

    // Load profile when the page loads
    window.onload = loadProfile;

    // Toggle between features
    function showFeature(featureId) {
        document.querySelectorAll('.feature-content').forEach(feature => {
            feature.style.display = 'none';
        });
        document.getElementById(featureId + '-feature').style.display = 'block';

        document.querySelectorAll('.feature-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        // Find and activate the correct button
        const buttons = document.querySelectorAll('.feature-btn');
        for (let btn of buttons) {
            if (btn.textContent.toLowerCase().includes(featureId)) {
                btn.classList.add('active');
                break;
            }
        }
    }

    // Preview image function
    function previewImage(input, previewImgId, previewTextId) {
        const previewImg = document.getElementById(previewImgId);
        const previewText = document.getElementById(previewTextId);

        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                previewImg.src = e.target.result;
                previewImg.style.display = 'block';
                previewText.style.display = 'none';
            };
            reader.onerror = function(error) {
                showErrorMessage(`Error reading image: ${error}`, 'error-message');
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    // Form submission for outfit analysis
    document.getElementById('analyzer-form').addEventListener('submit', function(e) {
        e.preventDefault();
        analyzeOutfit().catch(error => {
            showErrorMessage(`Error: ${error.message}`, 'error-message');
            document.getElementById('loader').style.display = 'none';
        });
    });

    // Form submission for outfit recommendations
    document.getElementById('recommend-form').addEventListener('submit', function(e) {
        e.preventDefault();
        getOutfitRecommendations().catch(error => {
            showErrorMessage(`Error: ${error.message}`, 'error-message-recommend');
            document.getElementById('loader-recommend').style.display = 'none';
        });
    });

    // Function to format the AI response into structured HTML
    function formatAnalysisResponse(text) {
        // Extract the main suitability score
        let mainScore = '4';
        const mainScoreMatch = text.match(/Overall Suitability\s*(\d+)\/10/i) || 
                             text.match(/Suitability Score\s*(\d+)\/10/i);
        if (mainScoreMatch && mainScoreMatch[1]) {
            mainScore = mainScoreMatch[1];
        }

        // Extract component scores
        const componentScores = {};
        const scoreRegex = /(.*?)\s*(\d+)\/10/g;
        let scoreMatch;
        while ((scoreMatch = scoreRegex.exec(text)) !== null) {
            const itemName = scoreMatch[1].trim();
            if (itemName && !itemName.toLowerCase().includes('overall')) {
                componentScores[itemName] = scoreMatch[2];
            }
        }

        // Process the rest of the sections
        const sections = {
            colorHarmony: extractSection(text, 'Color Harmony', 'Style Fit') || 
                         extractSection(text, 'color', 'style'),
            styleFit: extractSection(text, 'Style Fit', 'Suggestions') || 
                     extractSection(text, 'style', 'suggest'),
            suggestions: extractSection(text, 'Suggestions') || 
                        extractSection(text, 'suggest', '')
        };

        return {
            mainScore,
            componentScores,
            colorHarmony: formatSection(sections.colorHarmony),
            styleFit: formatSection(sections.styleFit),
            suggestions: formatSection(sections.suggestions)
        };
    }

    // Extract a section between two headings
    function extractSection(text, startHeading, endHeading) {
        const startIndex = text.indexOf(startHeading);
        if (startIndex === -1) return null;
        
        const endIndex = endHeading ? text.indexOf(endHeading, startIndex) : text.length;
        if (endIndex === -1) return null;
        
        return text.substring(startIndex + startHeading.length, endIndex).trim();
    }

    // Format a section with bullet points and paragraphs
    function formatSection(text) {
        if (!text) return '<p>No analysis available for this section.</p>';
        
        // Split into paragraphs
        let paragraphs = text.split('\n').filter(p => p.trim().length > 0);
        
        // Process each paragraph
        let html = '';
        for (let p of paragraphs) {
            // Check if this is a bullet point list
            if (p.match(/^\s*[-•*]\s+/)) {
                const items = p.split(/[-•*]\s+/).filter(i => i.trim().length > 0);
                if (items.length > 1) {
                    html += '<ul>';
                    for (let item of items) {
                        if (item.trim()) {
                            html += `<li>${item.trim()}</li>`;
                        }
                    }
                    html += '</ul>';
                    continue;
                }
            }
            
            // Check for numbered list
            if (p.match(/^\s*\d+\.\s+/)) {
                const items = p.split(/\d+\.\s+/).filter(i => i.trim().length > 0);
                if (items.length > 1) {
                    html += '<ol>';
                    for (let item of items) {
                        if (item.trim()) {
                            html += `<li>${item.trim()}</li>`;
                        }
                    }
                    html += '</ol>';
                    continue;
                }
            }
            
            // Check for subsection titles
            const subsectionMatch = p.match(/^(.*?):\s*$/);
            if (subsectionMatch) {
                html += `<div class="analysis-subsection-title">${subsectionMatch[1]}</div>`;
                continue;
            }
            
            // Check for improvement suggestions
            if (p.toLowerCase().includes('suggestion') || p.toLowerCase().includes('recommend')) {
                html += `<div class="improvement-suggestion"><div class="improvement-title">${p}</div>`;
                continue;
            }
            
            // Check for outfit examples
            if (p.toLowerCase().includes('example outfit')) {
                html += `<div class="outfit-example"><div class="outfit-title">${p}</div>`;
                continue;
            }
            
            // Regular paragraph
            if (p.trim()) {
                // Highlight color mentions
                p = p.replace(/(\b\w+ color\b)/gi, '<span style="font-weight:bold;color:#4f46e5">$1</span>');
                // Highlight body type mentions
                p = p.replace(/(\b\w+ body type\b)/gi, '<span style="font-weight:bold;color:#4f46e5">$1</span>');
                // Highlight scores
                p = p.replace(/(\d+\/10)/g, '<span class="analysis-score">$1</span>');
                html += `<p>${p}</p>`;
            }
        }
        
        return html || `<p>${text}</p>`;
    }

    // Function to make API call for outfit analysis
    async function analyzeOutfit() {
        const bodyType = document.getElementById('bodyType').value;
        const height = document.getElementById('height').value;
        const weight = document.getElementById('weight').value;
        const skinTone = document.getElementById('skinTone').value;
        const hairColor = document.getElementById('hairColor').value;
        const eyeColor = document.getElementById('eyeColor').value;
        const gender = document.getElementById('gender').value;
        const imageFile = document.getElementById('outfitImage').files[0];
        const useWardrobe = document.getElementById('use-wardrobe-analyze').checked;
        const selectedWardrobeItems = useWardrobe ? getSelectedWardrobeItems('analyze') : [];

        if (!imageFile && selectedWardrobeItems.length === 0) {
            throw new Error("Please upload an outfit image or select items from your wardrobe!");
        }

        // Validate all fields
        if (!bodyType || !height || !weight || !skinTone || !hairColor || !eyeColor || !gender) {
            throw new Error("Please fill in all required fields!");
        }

        // Show loader and hide previous results
        document.getElementById('loader').style.display = 'block';
        document.getElementById('analysis-section').style.display = 'none';
        hideErrorMessage('error-message');
        document.getElementById('result-section').style.display = 'block';

        // Prepare the base prompt
        let promptText = `Analyze this outfit for a person with the following details:
        - Body Type: ${bodyType}
        - Height: ${height} cm
        - Weight: ${weight} kg
        - Skin Tone: ${skinTone}
        - Hair Color: ${hairColor}
        - Eye Color: ${eyeColor}
        - Gender: ${gender}`;

        // Add wardrobe items to prompt if selected
        if (selectedWardrobeItems.length > 0) {
            promptText += formatWardrobeForPrompt(selectedWardrobeItems);
        }

        promptText += `\n\nProvide a detailed analysis including:
        1. Overall suitability score (1-10)
        2. Color harmony with their features
        3. Style fit for their body type
        4. Specific suggestions for improvements
        
        Format your response with clear headings for each section.`;

        // Prepare the API request payload
        const requestBody = {
            contents: [
                {
                    parts: [
                        { text: promptText }
                    ]
                }
            ]
        };

        // Add image to request if uploaded
        if (imageFile) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = async function () {
                    try {
                        const base64Image = reader.result.split(',')[1];
                        requestBody.contents[0].parts.push({
                            inline_data: {
                                mime_type: "image/jpeg",
                                data: base64Image
                            }
                        });

                        const analysis = await makeAnalysisRequest(requestBody);
                        displayAnalysisResults(analysis);
                        resolve();
                    } catch (error) {
                        reject(error);
                    }
                };
                reader.onerror = function(error) {
                    reject(new Error(`Error reading image file: ${error.message}`));
                };
                reader.readAsDataURL(imageFile);
            });
        } else {
            // No image, just text analysis
            try {
                const analysis = await makeAnalysisRequest(requestBody);
                displayAnalysisResults(analysis);
            } catch (error) {
                throw error;
            }
        }
    }

    // Display formatted analysis results
    function displayAnalysisResults(analysis) {
        document.getElementById('suitability-rating').textContent = `${analysis.mainScore}/10`;
        
        // Build suitability result with component scores
        let suitabilityHtml = '';
        for (const [item, score] of Object.entries(analysis.componentScores)) {
            suitabilityHtml += `
                <div class="analysis-subsection">
                    <div class="analysis-subsection-title">${item}: ${score}/10</div>
                    <p>${getItemCommentary(item, score)}</p>
                </div>
            `;
        }
        if (suitabilityHtml === '') {
            suitabilityHtml = '<p>Overall outfit evaluation based on your profile.</p>';
        }
        document.getElementById('suitability-result').innerHTML = suitabilityHtml;
        
        // Set other sections
        document.getElementById('color-harmony').innerHTML = analysis.colorHarmony;
        document.getElementById('style-fit').innerHTML = analysis.styleFit;
        document.getElementById('suggestions').innerHTML = analysis.suggestions;
        
        // Show the analysis section
        document.getElementById('analysis-section').style.display = 'block';
    }

    // Helper function for item commentary
    function getItemCommentary(item, score) {
        const commentaries = {
            'Jeans Only': {
                '4': 'Jeans can be a good starting point, but without other elements, it\'s difficult to give a higher score. The lack of a complete outfit heavily impacts the evaluation.'
            }
            // Add more items and scores as needed
        };
        
        return commentaries[item]?.[score] || 'No specific commentary available for this item.';
    }

    // Make the analysis API request
    async function makeAnalysisRequest(requestBody) {
        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent?key=${API_KEY}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestBody)
            });
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`API request failed: ${errorData.error?.message || 'Unknown error'}`);
            }

            const data = await response.json();

            // Hide loader
            document.getElementById('loader').style.display = 'none';

            if (data.candidates && data.candidates.length > 0) {
                const analysisText = data.candidates[0].content.parts[0].text;
                return formatAnalysisResponse(analysisText);
            } else {
                throw new Error('No analysis found in the response.');
            }
        } catch (error) {
            document.getElementById('loader').style.display = 'none';
            throw error;
        }
    }

    // Function to make API call for outfit recommendations
    async function getOutfitRecommendations() {
        const bodyType = document.getElementById('bodyType').value;
        const height = document.getElementById('height').value;
        const weight = document.getElementById('weight').value;
        const skinTone = document.getElementById('skinTone').value;
        const hairColor = document.getElementById('hairColor').value;
        const eyeColor = document.getElementById('eyeColor').value;
        const gender = document.getElementById('gender').value;
        const garmentDescription = document.getElementById('garmentDescription').value;
        const imageFile = document.getElementById('garmentImage').files[0];
        const useWardrobe = document.getElementById('use-wardrobe-recommend').checked;
        const selectedWardrobeItems = useWardrobe ? getSelectedWardrobeItems('recommend') : [];

        if (!garmentDescription && selectedWardrobeItems.length === 0) {
            throw new Error("Please describe the garment you want to wear or select items from your wardrobe!");
        }

        // Validate all fields
        if (!bodyType || !height || !weight || !skinTone || !hairColor || !eyeColor || !gender) {
            throw new Error("Please fill in all required profile fields first!");
        }

        // Show loader
        document.getElementById('loader-recommend').style.display = 'block';
        document.getElementById('recommend-analysis-section').style.display = 'none';
        hideErrorMessage('error-message-recommend');
        document.getElementById('recommend-result-section').style.display = 'block';

        // Prepare the base prompt
        let promptText = `Based on ${
            garmentDescription ? `this garment description "${garmentDescription}"` : 'these selected wardrobe items'
        }, recommend a complete outfit for a person with the following details:
        - Body Type: ${bodyType}
        - Height: ${height} cm
        - Weight: ${weight} kg
        - Skin Tone: ${skinTone}
        - Hair Color: ${hairColor}
        - Eye Color: ${eyeColor}
        - Gender: ${gender}`;

        // Add wardrobe items to prompt if selected
        if (selectedWardrobeItems.length > 0) {
            promptText += formatWardrobeForPrompt(selectedWardrobeItems);
        }

        promptText += `\n\nProvide detailed recommendations including:
        1. How suitable the described garment is for this body type (score 1-10)
        2. Specific items to pair with the described garment
        3. Style suggestions for this person's body type and features
        4. Complete outfit ideas incorporating the described garment
        
        Format your response with clear headings for each section.`;

        // Prepare the API request payload
        const requestBody = {
            contents: [
                {
                    parts: [
                        { text: promptText }
                    ]
                }
            ]
        };

        // Add image to request if uploaded
        if (imageFile) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = async function () {
                    try {
                        const base64Image = reader.result.split(',')[1];
                        requestBody.contents[0].parts.push({
                            inline_data: {
                                mime_type: "image/jpeg",
                                data: base64Image
                            }
                        });

                        await makeRecommendationRequest(requestBody);
                        resolve();
                    } catch (error) {
                        reject(error);
                    }
                };
                reader.onerror = function(error) {
                    reject(new Error(`Error reading image file: ${error.message}`));
                };
                reader.readAsDataURL(imageFile);
            });
        } else {
            // No image, just text analysis
            return makeRecommendationRequest(requestBody);
        }
    }

    // Make the recommendation API request
    async function makeRecommendationRequest(requestBody) {
        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent?key=${API_KEY}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestBody)
            });
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(`API request failed: ${errorData.error?.message || 'Unknown error'}`);
            }

            const data = await response.json();

            // Hide loader
            document.getElementById('loader-recommend').style.display = 'none';

            if (data.candidates && data.candidates.length > 0) {
                const recommendationText = data.candidates[0].content.parts[0].text;
                const formattedRecommendation = formatAnalysisResponse(recommendationText);

                // Display the recommendations
                document.getElementById('garment-suitability').innerHTML = formattedRecommendation.suitability;
                document.getElementById('recommended-items').innerHTML = formattedRecommendation.colorHarmony;
                document.getElementById('style-suggestions').innerHTML = formattedRecommendation.styleFit;
                document.getElementById('outfit-ideas').innerHTML = formattedRecommendation.suggestions;
                
                document.getElementById('recommend-analysis-section').style.display = 'block';
            } else {
                throw new Error('No recommendations found in the response.');
            }
        } catch (error) {
            document.getElementById('loader-recommend').style.display = 'none';
            throw error;
        }
    }
</script>
</body>
</html>